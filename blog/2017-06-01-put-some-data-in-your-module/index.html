<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><link href=../../css/fonts.css rel=stylesheet type=text/css><title>Put some data in your module</title><link rel=stylesheet href=../../css/hugo-octopress.css><link rel=stylesheet href=../../css/fork-awesome.min.css><link href=../../favicon.png rel=icon><meta name=description content><meta name=keywords content><meta name=author content="Corey Osman"><meta name=generator content="Hugo 0.82.0"></head><body><header role=banner><hgroup><h1><a href=../../>Logical thoughts exposed</a></h1><h2>A journey through my life as a infrastructure developer</h2></hgroup></header><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value"><option value>Navigateâ€¦</option></select></fieldset><ul class=main-navigation></ul><ul class=subscription><a href=../../index.xml target=_blank type=application/rss+xml title=RSS rel="noopener noreferrer"><i class="fa fa-rss-square fa-lg"></i></a></ul><form action=https://www.google.com/search method=get target=_blank rel="noopener noreferrer"><fieldset role=search><input class=search type=text name=q results=0 placeholder=Search>
<input type=hidden name=q value=site:/></fieldset></form></nav><div id=main><div id=content><div><article class=hentry role=article><header><p class=meta>Jun 1, 2017
- 3 minute read
- <a href=../../blog/2017-06-01-put-some-data-in-your-module/#disqus_thread>Comments</a>
- <a class=label href=../../categories/devops/>devops </a><a class=label href=../../categories/puppet/>puppet </a><a class=label href=../../categories/retrospec/>retrospec </a><a class=label href=../../categories/generator/>generator </a><a class=label href=../../categories/hiera/>hiera</a></p><h1 class=entry-title>Put some data in your module</h1></header><div class=entry-content><p>Puppet 4.9 cemented the final touches to putting data in puppet modules with the release of hiera 5.
Which by the way hiera is now part of Puppet project instead of a separate gem as with previous versions.</p><p>So now that that whole params.pp mess is over we can finally move forward and create modules with rich sets
of data without resorting to the params.pp hack.</p><p>So lets get started. In order to put data in your module you need to have a few things.</p><h2 id=requirements>Requirements</h2><p>Ideally, you should be running puppet 4.9 to take advantage of hiera 5 and data in modules.
But if you happen to be running puppet 4.7-4.8 you can still utilize hiera 4 which contains similar features.</p><p>Just note that when upgrading to puppet 4.9+ hiera 4 implementations will need to eventually be onverted to hiera 5.
This article will only focus on hiera 5 but the methods below are extremely similar for hiera 4.</p><ul><li>Puppet 4.9+</li></ul><h2 id=data-in-module-the-manual-way>Data in module the manual way</h2><ol><li>Create a hiera.yaml file inside your module with at a minimum the following contents. Also figure out which backend type to use.</li><li>Create a data directory <code>mkdir data</code>. This should be in your module&rsquo;s root directory.</li><li>Create a common.yaml file</li><li>Optionally, create a <code>data/os</code> directory</li><li>Add hiera data to common.yaml</li></ol><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>  ---
  <span style=color:#268bd2>version</span>: <span style=color:#2aa198>5</span>
  <span style=color:#268bd2>defaults</span>:
    <span style=color:#268bd2>datadir</span>: data
    <span style=color:#268bd2>data_hash</span>: yaml_data
  <span style=color:#268bd2>hierarchy</span>:
      - <span style=color:#268bd2>name</span>: <span style=color:#2aa198>&#34;OS family&#34;</span>
        <span style=color:#268bd2>path</span>: <span style=color:#2aa198>&#34;os/%{facts.os.family}.yaml&#34;</span>
      - <span style=color:#268bd2>name</span>: <span style=color:#2aa198>&#34;common&#34;</span>
        <span style=color:#268bd2>path</span>: <span style=color:#2aa198>&#34;common.yaml&#34;</span>
</code></pre></div><p>Note: only keys that start with your module&rsquo;s class name will be referenced, unless you are doing hiera interpolation.</p><h2 id=automatic-way>Automatic way</h2><p>Retrospec automates all the steps above. So to get started install retrospec.</p><p><code>gem install puppet-retrospec facter</code> and perform the following.</p><ol><li>cd your_module_path</li><li>retrospec puppet module_data</li></ol><p>Retrospec will clone down it&rsquo;s templates and create all the necessary files to get module data up and running. Yup! A single command. Pretty easy right? Best of all you can do this over and over on all your modules!</p><p>If you doing advanced lookup backends retrospec also allows additional options should you want to create a custom function for lookup. See <code>retrospec puppet module_data -h</code> for more options.</p><p><code>retrospec puppet module_data -b data_hash -n my_custom_hash -t native</code></p><pre><code>Options:
  -b, --backend-type=&lt;s&gt;     Which hiera backend type to use (hiera, data_hash, lookup_key, data_dig) (default: hiera)
  -n, --backend-name=&lt;s&gt;     The name of the custom backend (default: custom)
  -t, --function-type=&lt;s&gt;    What type of function to create the backend type with (native or v4) (default: native)
  -h, --help                 Show this message
</code></pre><p>Most of the time you will just want to use the defaults but some will be cooking up some fancy backends and need a way to easily generate the lookup backend.</p><h2 id=hierarchy-setup>Hierarchy Setup</h2><p>Unfortunately, Retrospec does not put the data in your hiera files. It does dump all the class parameters into common.yaml but you still need to sort out the values and hierarchy configuration for each parameter key. This might take some time to figure out.</p><p>If your module currently uses params.pp I would start there.</p></div><footer><p class=meta><span class="byline author vcard">Posted by <span class=fn>Corey Osman</span></span>
<time>Jun 1, 2017</time></span></p><p class=meta><a class="basic-alignment left" href=../../blog/2017-04-25-break-into-your-puppet-code/ title="Break into your puppet code">Break into your puppet code</a>
<a class="basic-alignment right" href=../../blog/2017-10-12-retrospec-the-task-generator/ title="Retrospec - the task generator">Retrospec - the task generator</a></p><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//logicalthoughtsexposed.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></footer></article></div><aside class="sidebar thirds"><section class="first odd"><p></p></section><ul class=sidebar-nav><li class=sidebar-nav-item><a target=_blank rel="noopener noreferrer" href=https://github.com/nwops/ title=https://github.com/nwops/><i class="fa fa-github fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://twitter.com/cosman2001 title=https://twitter.com/cosman2001><i class="fa fa-twitter fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://www.linkedin.com/in/logicmindscorp/ title=https://www.linkedin.com/in/logicmindscorp/><i class="fa fa-linkedin fa-3x"></i></a></li></ul><section class=odd><li><a href=../../categories/ title=Categories>Categories</a></li><li><a href=../../tags/ title=Tags>Tags</a></li></section><section class=even><h1>Recent Posts</h1><ul id=recent_posts><li class=post><a href=../../blog/2021-03-13-decouple-your-control-repo-branches/>Decouple Your Control Repo Branches</a></li><li class=post><a href=../../blog/2021-02-15-no-code-is-the-best-code/>No Code Is the Best Code</a></li><li class=post><a href=../../blog/2021-02-14-getting-real-with-the-ral/>Getting real with the RAL</a></li><li class=post><a href=../../blog/2019-04-02-adding-puppet-debugger-and-other-gems-when-using-pdk/>Adding Puppet Debugger and other gems when using PDK</a></li><li class=post><a href=../../blog/2018-09-25-alternative-facts/>Alternative Facts</a></li><li class=post><a href=../../blog/2018-09-25-debugging-and-inspecting-hiera-lookups/>Debugging and Inspecting hiera lookups</a></li><li class=post><a href=../../blog/2017-10-12-retrospec-the-task-generator/>Retrospec - the task generator</a></li><li class=post><a href=../../blog/2017-06-01-put-some-data-in-your-module/>Put some data in your module</a></li><li class=post><a href=../../blog/2017-04-25-break-into-your-puppet-code/>Break into your puppet code</a></li></ul></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2021 Corey Osman - <a href=../../license/>License</a> -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io rel="noopener noreferrer">Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/ rel="noopener noreferrer">Hugo-Octopress</a> theme.</p></footer></body></html>