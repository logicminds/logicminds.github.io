<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><link href=../../css/fonts.css rel=stylesheet type=text/css><title>Remotely Controlling Your Server With IPMI</title><link rel=stylesheet href=../../css/hugo-octopress.css><link rel=stylesheet href=../../css/fork-awesome.min.css><link href=../../favicon.png rel=icon><meta name=description content><meta name=keywords content><meta name=author content="Corey Osman"><meta name=generator content="Hugo 0.82.0"></head><body><header role=banner><hgroup><h1><a href=../../>Logical thoughts exposed</a></h1><h2>A journey through my life as a infrastructure developer</h2></hgroup></header><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value"><option value>Navigate…</option></select></fieldset><ul class=main-navigation></ul><ul class=subscription><a href=../../index.xml target=_blank type=application/rss+xml title=RSS rel="noopener noreferrer"><i class="fa fa-rss-square fa-lg"></i></a></ul><form action=https://www.google.com/search method=get target=_blank rel="noopener noreferrer"><fieldset role=search><input class=search type=text name=q results=0 placeholder=Search>
<input type=hidden name=q value=site:/></fieldset></form></nav><div id=main><div id=content><div><article class=hentry role=article><header><p class=meta>Apr 10, 2015
- 5 minute read
- <a href=../../blog/2015-04-10-remotely-controlling-your-server-with-ipmi/#disqus_thread>Comments</a>
- <a class=label href=../../categories/sysadmin/>sysadmin </a><a class=label href=../../categories/remote/>remote </a><a class=label href=../../categories/ipmi/>ipmi </a><a class=label href=../../categories/bmc/>bmc</a></p><h1 class=entry-title>Remotely Controlling Your Server With IPMI</h1></header><div class=entry-content><p>In 2010 my life changed dramatically as I moved from Atlanta, GA to Portland, OR. During this time I maintained a 100%
remote position where I controlled twenty unique datacenters all over the country with my computer and a VPN connection.
Due to to the nature of the company, problems only seemed to present themselves during the early hours (After 12AM). On
several occasions I found the need to turn off a production system due to power or cooling issues. Traditionally, this
was easily accomplished by picking up the phone and instructing a person to perform a task. However, finding an able
body in the middle of the night sometimes extended downtime past a few hours. And god forbid they might turn off the
wrong system. This led to unnecessary downtime in my opinion that could have been prevented by using out-of-band
management.</p><p>What is out-of-band management? Essentially, out-of-band management is a device that allows you to perform
actions on a server as if you were standing in front of it. This type of management works independently of the OS, so
if the OS crashes you still have a way in. The standard protocol behind out-of-band management is called IPMI.
However, many device manufactures had similar solutions before IPMI was even available. Solutions like HP’s iLO, IBM’s
OSA, Dell’s DRAC, and Sun’s iLom. When IPMI came along, server manufactures shoe-horned IPMI support into their
proprietary out-of-band management devices. The end result is a buggy IPMI device that “mostly” works. However, what
IPMI provides is standard mechanism to control any kind of server despite its origin. Fortunately, newer IPMI devices
are more compliant with the IPMI protocol than their predecessors.</p><h2 id=setup>Setup</h2><p>The first thing you need to know about IPMI is that it is not configured out the box. In many situations you will need
to configure the IPMI device from the BIOS or upon bootup. If your lucky enough to be using a server that sets up IPMI
automatically via DHCP then your in luck. For example, HP ilo devices will use the dhcp assigned ip address when plugged
in. Some devices like HP ilo come with a unique username/password to initially login to the device, while others have
some sort of insecure default credentials hidden in the manual. Essentially what you need to do is login (via ssh or
http) to the device and configure to your requirements. In a later article I will detail how you can automate the
deployment of IPMI devices so you never have to perform this step manually again.</p><h2 id=locating-that-special-port>Locating that special port</h2><p>As you can see in the following picture the ilo device is the special out-of-band management device that allows us to
use IPMI commands to control the server remotely. It looks just like a normal ethernet port but is usually marked
specifically for the BMC controller (ilo, ipmi, drac, &mldr;). So just plug a ethernet cable in and find the IP address using
nmap, dhcp logs, or other mechanism.</p><p><img src=../images/Hp_proliant_dl380_g5_5-300x135.jpg alt="Server with IPMI device"></p><h2 id=remotely-controlling-that-server>Remotely controlling that server</h2><p>Usually each IPMI device has a web interface for configuring and controlling the device. So initially, you will have to
use this interface to set it up. In the picture below I have logged into the device and clicked on power management and
then clicked momentary press to turn the server on. Disclaimer: I am not responsible for you powering on/off servers
in any of your environments. Make sure you know what your doing.</p><p><img src=../images/ilo.png alt="ilo page"></p><p>Once the IPMI device turns the server on the options change and we can now see the server is powered on.</p><p><img src=../images/ilo_on.png alt="ilo page"></p><p>Some of you may be asking yourself, is there a CLI tool to perform these functions? The answer is yes, however
the CLI commands are generic in nature and some functionality may not be available in the opensource CLI tools. But,
the majority of what you want to do should be supported.</p><p>These tools are
<a href=http://www.gnu.org/software/freeipmi/ target=_blank rel=noopener>freeipmi</a> and
<a href=http://sourceforge.net/projects/ipmitool target=_blank rel=noopener>ipmitool</a> both of which perform the same function but differ in implementation.
Additionally, there is
<a href=http://openipmi.sourceforge.net target=_blank rel=noopener>openipmi</a> which works as a driver that freeipmi and ipmitool
use for communication with the IPMI device. But openipmi is not necessary if you know the username, password and ip
address of the IPMI device.</p><p>With one of these tools installed you can skip the web UI and remotely control the system from any unix based system running
either ipmitool or freeipmi.</p><pre><code>ipmitool -H 192.168.1.21 -U admin -P password -I lanplus power on
Chassis Power Control: Up/On

</code></pre><h2 id=futher-reading>Futher reading</h2><p>Now if your wondering just how to configure your IPMI device using configuration management have a look at the
<a href=https://github.com/logicminds/bmclib target=_blank rel=noopener>bmclib</a> puppet module for configuring each IPMI device. Bmclib internally uses
ipmitool and openipmi so that you don&rsquo;t have to.</p><p>Additionally, if you are looking for a way to interact with the IPMI device pragmatically you can use the
<a href=https://github.com/logicminds/rubyipmi target=_blank rel=noopener>Rubyipmi</a> library directly without having to know any knowledge of ipmitool or
freeipmi.</p><p>There is a ton of imformation you can get out of the IPMI device like sensor information and event logs so its worth exploring
with Rubyipmi if you plan on doing sensor monitoring of some sort.</p><p>A great example of monitoring with Rubyipmi and
<a href=https://github.com/sensu/sensu-community-plugins/blob/master/plugins/ipmi/check-sensor.rb target=_blank rel=noopener>Sensu</a>.</p><h2 id=summary>Summary</h2><p>Now that you know how to remotely control your servers you can spend more time doing other things since you won&rsquo;t be
on the phone instructing other people to turn the server off. Furthermore, stand up and move your legs since you just
removed the need to walk to the server room and reduced your daily pedometer score.</p></div><footer><p class=meta><span class="byline author vcard">Posted by <span class=fn>Corey Osman</span></span>
<time>Apr 10, 2015</time></span></p><p class=meta><a class="basic-alignment right" href=../../blog/2015-04-14-testing-your-infallibility-part-1/ title="Testing Your infallibility - Part 1">Testing Your infallibility - Part 1</a></p><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//logicalthoughtsexposed.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></footer></article></div><aside class="sidebar thirds"><section class="first odd"><p></p></section><ul class=sidebar-nav><li class=sidebar-nav-item><a target=_blank rel="noopener noreferrer" href=https://github.com/nwops/ title=https://github.com/nwops/><i class="fa fa-github fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://twitter.com/cosman2001 title=https://twitter.com/cosman2001><i class="fa fa-twitter fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://www.linkedin.com/in/logicmindscorp/ title=https://www.linkedin.com/in/logicmindscorp/><i class="fa fa-linkedin fa-3x"></i></a></li></ul><section class=odd><li><a href=../../categories/ title=Categories>Categories</a></li><li><a href=../../tags/ title=Tags>Tags</a></li></section><section class=even><h1>Recent Posts</h1><ul id=recent_posts><li class=post><a href=../../blog/2021-03-13-decouple-your-control-repo-branches/>Decouple Your Control Repo Branches</a></li><li class=post><a href=../../blog/2021-02-15-no-code-is-the-best-code/>No Code Is the Best Code</a></li><li class=post><a href=../../blog/2021-02-14-getting-real-with-the-ral/>Getting real with the RAL</a></li><li class=post><a href=../../blog/2019-04-02-adding-puppet-debugger-and-other-gems-when-using-pdk/>Adding Puppet Debugger and other gems when using PDK</a></li><li class=post><a href=../../blog/2018-09-25-alternative-facts/>Alternative Facts</a></li><li class=post><a href=../../blog/2018-09-25-debugging-and-inspecting-hiera-lookups/>Debugging and Inspecting hiera lookups</a></li><li class=post><a href=../../blog/2017-10-12-retrospec-the-task-generator/>Retrospec - the task generator</a></li><li class=post><a href=../../blog/2017-06-01-put-some-data-in-your-module/>Put some data in your module</a></li><li class=post><a href=../../blog/2017-04-25-break-into-your-puppet-code/>Break into your puppet code</a></li></ul></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2021 Corey Osman - <a href=../../license/>License</a> -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io rel="noopener noreferrer">Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/ rel="noopener noreferrer">Hugo-Octopress</a> theme.</p></footer></body></html>